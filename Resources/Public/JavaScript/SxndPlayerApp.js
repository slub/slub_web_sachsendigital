(()=>{"use strict";var e,t={975:(e,t,i)=>{i(367);const s={None:0,CtrlMeta:1,Shift:2,Alt:4};function n(e,t){const i=Object.assign({},t);for(const[s,n]of Object.entries(t)){const t=e[s],o=null!=t?t:n;switch(typeof n){case"boolean":i[s]=!0===o||Boolean(Number(o));break;case"number":i[s]=Number(o);break;case"string":i[s]=String(o)}}return i}class o{constructor(e){this.elements=e.slice(),this.elements.sort(((e,t)=>e.timecode-t.timecode)),this.elementToIndex=new Map;for(const[e,t]of this.elements.entries())this.elementToIndex.set(t,e)}at(e){return this.elements[e]}indexOf(e){return this.elementToIndex.get(e)}advance(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const i=this.indexOf(e);if(void 0!==i)return this.elements[i+t]}timeToElement(e){var t;return null===(t=this.timeToEntry(e))||void 0===t?void 0:t[1]}timeToEntry(e){if(0===this.elements.length)return;let t=0,i=this.elements.length-1;for(;t+1<i;){const s=Math.floor((t+i)/2);this.elements[s].timecode<=e?t=s:i=s}const s=this.elements[i];if(s.timecode<=e)return[i,s];const n=this.elements[t];return n.timecode<=e?[t,n]:void 0}[Symbol.iterator](){return this.elements.values()}*reversed(){for(let e=this.elements.length-1;e>=0;e--)yield this.elements[e]}}class r extends o{timeToChapter(e){return this.timeToElement(e)}}var a=i(480),l=i.n(a);function h(e,t){let[i,s]=t;return e<i?i:e>s?s:e}function d(e,t){let i=e;for(const[e,s]of Object.entries(t))void 0!==s&&(i=i.split("{".concat(e,"}")).join(s));return i}function c(e,t){return e.toString().padStart(t,"0")}async function u(e){const t=g("img");return t.decoding="async",t.src=e,await t.decode(),t}function p(e,t){"string"==typeof e?g("a",{href:e,download:t}).click():m(e,(e=>{p(e,t)}))}function m(e,t){const i=URL.createObjectURL(e);let s;try{s=t(i)}catch(e){throw URL.revokeObjectURL(i),e}if(s instanceof Promise){const e=s;return new Promise(((t,s)=>{e.then((e=>{URL.revokeObjectURL(i),t(e)})).catch((e=>{URL.revokeObjectURL(i),s(e)}))}))}return URL.revokeObjectURL(i),s}function v(e){return e.preventDefault(),!1}function f(e,t){const i=[],s=Array.isArray(t)?t:[t];for(let t=0;t<e.length;t++){if(t>0)for(const e of s){const t="string"==typeof e?e:e.cloneNode(!0);i.push(t)}i.push(e[t])}return i}function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const s=document.createElement(e);for(const[e,i]of Object.entries(t))"$"===e[0]?s.addEventListener(e.substring(1),i):s[e]=i;for(const e of i)"string"==typeof e?s.append(document.createTextNode(e)):e instanceof HTMLElement&&s.append(e);return s}function y(e,t,i){i?e.classList.add(t):e.classList.remove(t)}function k(e){return e.filter((e=>null!==e))}class b extends l().ui.Element{static register(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=e.mkid();return l().ui.Controls.registerElement(i,{create:(i,s)=>new this(i,s,e,t)}),i}constructor(e,t,i){var s;let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(e,t),this.env=i;const o=g("button",{className:"material-icons-round ".concat(null!==(s=n.className)&&void 0!==s?s:"")},[n.material_icon]);e.appendChild(o),this.dlf={config:n,button:o};const{onClickAction:r}=n;this.eventManager&&r&&(this.eventManager.listen(o,"click",(()=>{r.isAvailable()&&r.execute()})),this.eventManager.listen(this.player,"loaded",(()=>{this.updateControlPanelButton()}))),this.updateControlPanelButton()}updateControlPanelButton(){var e;let t=null!==(e=this.dlf.config.title)&&void 0!==e?e:"";this.dlf.button.ariaLabel=t,y(this.dlf.button,"shaka-tooltip",""!==t);const{onClickAction:i}=this.dlf.config;i&&y(this.dlf.button,"shaka-hidden",!i.isAvailable())}}class w{constructor(){this.tasks={}}get(e){var t,i;const s=null!==(i=(t=this.tasks)[e])&&void 0!==i?i:t[e]=this.createTask(e);return this.resumeTask(s)}getCached(e){var t;const i=null===(t=this.tasks[e])||void 0===t?void 0:t.state;return 4===(null==i?void 0:i.type)?i.image:null}abortPending(){for(const[e,t]of Object.entries(this.tasks))this.stopTask(t)}createTask(e){return{state:{type:0,url:e},promise:null,stopNext:!1}}stopTask(e){e.stopNext=!0}resumeTask(e){return e.stopNext=!1,null===e.promise&&(e.promise=new Promise((async(t,i)=>{try{for(;;){if(4===e.state.type){t(e.state.image);break}if(e.stopNext){e.promise=null;break}await this.progressTask(e)}}catch(e){i(e)}}))),e.promise}async progressTask(e){switch(e.state.type){case 0:{const t=new AbortController,i=e.state.url,s=fetch(i,{signal:t.signal});e.state={type:1,abortController:t,responsePromise:s};break}case 1:{const t=await e.state.responsePromise;if(!t.ok)throw t;e.state={type:2,imageBlob:await t.blob()};break}case 2:e.state={type:3,imagePromise:(t=e.state.imageBlob,m(t,u))};break;case 3:{const t=await e.state.imagePromise;e.state={type:4,image:t};break}}var t}}function T(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=t?"{h}:{mm}:{ss}":"{m}:{ss}";return i&&(s+=":{ff}",t||(s+="f")),C(s,e,i)}function C(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=P(t,null!=i?i:0);return d(e,{h:"".concat(s.hours),hh:c(s.hours,2),m:"".concat(s.totalMinutes),mm:c(s.minutes,2),ss:c(s.seconds,2),ff:c(s.frames,2)})}function P(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=Math.floor(e/3600),s=Math.floor(e/60%60),n=60*i+s,o=Math.floor(e%60),r=Math.floor(e%1*t);return{hours:i,minutes:s,totalMinutes:n,seconds:o,frames:r}}class S{constructor(e){this.seekBar=e.seekBar,this.player=e.player,this.network=e.network,this.interaction=e.interaction,this.fps=null,this.chapters=null,this.thumbnailTracks=[],this.snapToThumbnail=null,this.lastRendered=null,this.isChanging=!1,this.deltaStart=null,this.current=null,this.renderAnimationFrame=null,this.seekMode="wide",this.openDisplayTimeout=null,this.handlers={onWindowBlur:this.onWindowBlur.bind(this),onWindowResize:this.onWindowResize.bind(this),onPointerMove:this.onPointerMove.bind(this),onPointerDown:this.onPointerDown.bind(this),onPointerUpOrCancel:this.onPointerUpOrCancel.bind(this)},this.$container=g("div",{className:"dlf-media-thumbnail-preview"},[g("div",{className:"content-box"},[this.$display=g("div",{className:"display"},[this.$img=g("img")]),this.$info=g("span",{className:"info"},[this.$chapterText=g("span",{className:"chapter-text"}),this.$timecodeText=g("span",{className:"timecode-text"})])])]),this.$seekMarker=g("div",{className:"seek-marker"}),this.$seekThumbBar=g("div",{className:"seek-thumb-bar"}),this.seekBar.append(this.$seekMarker,this.$seekThumbBar,this.$container),this.ensureDisplaySize(160,90),window.addEventListener("blur",this.handlers.onWindowBlur),window.addEventListener("resize",this.handlers.onWindowResize),document.addEventListener("pointermove",this.handlers.onPointerMove),document.addEventListener("pointerdown",this.handlers.onPointerDown),document.addEventListener("pointerup",this.handlers.onPointerUpOrCancel),document.addEventListener("pointercancel",this.handlers.onPointerUpOrCancel)}release(){window.removeEventListener("blur",this.handlers.onWindowBlur),window.removeEventListener("resize",this.handlers.onWindowResize),document.removeEventListener("pointermove",this.handlers.onPointerMove),document.removeEventListener("pointerdown",this.handlers.onPointerDown),document.removeEventListener("pointerup",this.handlers.onPointerUpOrCancel),document.removeEventListener("pointercancel",this.handlers.onPointerUpOrCancel)}setFps(e){this.fps=e,this.currentRenderBest()}setChapters(e){this.chapters=e,this.currentRenderBest()}async setThumbnailTracks(e){this.thumbnailTracks=e.slice(),this.thumbnailTracks.sort(((e,t)=>t.bandwidth-e.bandwidth)),await this.setThumbnailSnap(!1)}async setThumbnailSnap(e){var t,i,s;this.snapToThumbnail=e&&null!==(t=null!==(i=null===(s=this.lastRendered)||void 0===s?void 0:s.thumb.track)&&void 0!==i?i:this.thumbnailTracks[0])&&void 0!==t?t:null,this.current&&(this.current.seekPosition=await this.snapPosition(this.current.rawSeekPosition)),this.current&&this.renderSeekPosition(this.current.seekPosition),this.currentRenderBest()}setSeekMode(e){this.seekMode=e,this.currentRenderBest()}onWindowBlur(){this.cancelPreview()}onWindowResize(){this.cancelPreview()}async onPointerMove(e){const t=this.mouseEventToPosition(e);if(void 0===t)return this.setIsVisible(!1);const i=await this.snapPosition(t);"touch"===e.pointerType&&this.beginChange();let s=[];if(this.showThumbnailImage()){const e=i.seconds,t=.01*this.player.getStats().estimatedBandwidth;s=await this.getThumbnails(e,t)}const n=null===this.current;var o,r;this.current={rawSeekPosition:t,seekPosition:i,thumbs:s},this.isChanging&&0!=(1&e.buttons)&&(null===(o=this.interaction)||void 0===o||null===(r=o.onChange)||void 0===r||r.call(o,i)),this.currentRenderBest(n)}async onPointerDown(e){if(0!=(1&e.buttons)){const s=this.mouseEventToPosition(e,"mouse"===e.pointerType);if(void 0!==s){var t,i;const e=await this.snapPosition(s);this.beginChange(),null===(t=this.interaction)||void 0===t||null===(i=t.onChange)||void 0===i||i.call(t,e)}}}onPointerUpOrCancel(e){this.endChange(),"mouse"===e.pointerType&&void 0!==this.mouseEventToPosition(e)||this.setIsVisible(!1)}mouseEventToPosition(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this.saneVideoDuration();if(void 0===i)return;if(null!==document.querySelector("input[type=button]:hover, button:hover"))return;const s=this.seekBar.getBoundingClientRect();let n=s.left;if(null!==this.deltaStart){const e=s.width/i;n=this.deltaStart.clientX-this.deltaStart.seconds*e}if(!this.isChanging)if(this.isVisible&&t){const{right:t,bottom:i}=s;if(!(n<=e.clientX&&e.clientX<=t&&e.clientY<=i))return;let{top:o}="wide"===this.seekMode?this.$container.getBoundingClientRect():this.seekBar.getBoundingClientRect();if(null!==this.openDisplayTimeout&&(o+=(i-o)/2),!(o<=e.clientY))return}else if(!(e.target instanceof Node&&this.seekBar.contains(e.target)))return;const o=i/s.width;return{absoluteRaw:h(e.clientX-n,[0,s.width]),secondsPerPixel:o}}async snapPosition(e){var t;let{absoluteRaw:i,secondsPerPixel:s}=e,n=i*s;const o=null===(t=this.chapters)||void 0===t?void 0:t.timeToChapter(n+2*s);let r=!1;if(!this.isChanging){if(null!==this.snapToThumbnail){const e=await this.getSingleThumbnail(this.snapToThumbnail,n);null!==e&&(n=e.imageTime,i=n/s)}o&&(n-o.timecode)/s<6&&(null===this.snapToThumbnail&&(n=o.timecode,i=n/s),r=!0)}return{absolute:i,seconds:n,chapter:o,onChapterMarker:r}}ensureDisplaySize(e,t){const i=Math.floor(160/e*t);this.$display.clientHeight!==i&&(this.$display.style.height="".concat(i,"px"))}currentRenderBest(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&null===this.openDisplayTimeout?this.openDisplayTimeout=setTimeout((()=>{this.openDisplayTimeout=null,this.currentRenderBest()}),100):null===this.openDisplayTimeout&&null===this.renderAnimationFrame&&(this.renderAnimationFrame=window.requestAnimationFrame((()=>{this.renderAnimationFrame=null;const e=this.current;if(null!==e){this.setIsVisible(!0,e.thumbs.length>0,!1),this.renderSeekPosition(e.seekPosition);for(const t of e.thumbs){const i=t.uris[0];if(void 0===i)continue;const s=this.network.getCached(i);if(null!==s){this.renderImageAndShow(i,t,s,e.seekPosition);break}this.network.get(i).then((()=>{this.currentRenderBest()}))}}})))}renderImageAndShow(e,t,i,s){this.ensureDisplaySize(t.width,t.height),this.renderImage(e,t,i),this.setIsVisible(!0),this.positionContainer(s),this.renderSeekPosition(s,t)}renderImage(e,t,i){if(arguments.length>3&&void 0!==arguments[3]&&arguments[3]||null===this.lastRendered||t.imageTime!==this.lastRendered.thumb.imageTime||t.bandwidth!==this.lastRendered.thumb.bandwidth){const{positionX:s,positionY:n,width:o,height:r}=t,a=160/o;this.$img.replaceWith(i),this.$img=i,this.$img.style.transform=["scale(".concat(a,")"),"translateX(-".concat(s,"px)"),"translateY(-".concat(n,"px)")].join(" "),this.$img.style.transformOrigin="left top",this.lastRendered={uri:e,thumb:t,tilesetImage:i}}}positionContainer(e){const t=h(e.absolute-this.$container.offsetWidth/2,[0,this.seekBar.clientWidth-this.$container.offsetWidth]);this.$container.style.left="".concat(t,"px")}renderSeekPosition(e){var t,i;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this.saneVideoDuration();if(void 0===n)return void this.setIsVisible(!1);this.$seekMarker.style.left="".concat(e.absolute,"px"),null!==s&&null!==this.snapToThumbnail&&(this.$seekThumbBar.style.left="".concat(s.startTime/n*100,"%"),this.$seekThumbBar.style.width="".concat(s.duration/n*100,"%")),e.onChapterMarker?this.$info.classList.add("on-chapter-marker"):this.$info.classList.remove("on-chapter-marker");const o=null!==(t=null===(i=e.chapter)||void 0===i?void 0:i.title)&&void 0!==t?t:"";this.$chapterText.innerText=o,y(this.$chapterText,"displayed",""!==o),this.$timecodeText.innerText=T(e.seconds,n>=3600,this.fps),this.positionContainer(e)}cancelPreview(){this.setIsVisible(!1),this.endChange()}beginChange(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;var t,i;this.isChanging||(this.deltaStart=this.convertDelta(e),null===(t=this.interaction)||void 0===t||null===(i=t.onChangeStart)||void 0===i||i.call(t),document.body.classList.add("seek-or-scrub"),this.isChanging=!0)}convertDelta(e){if(null===e)return null;const t=this.player.getMediaElement();return null===t?null:{clientX:e,seconds:t.currentTime}}endChange(){var e,t;this.isChanging&&(this.deltaStart=null,null===(e=this.interaction)||void 0===e||null===(t=e.onChangeEnd)||void 0===t||t.call(e),document.body.classList.remove("seek-or-scrub"),this.isChanging=!1)}get isVisible(){return null!==this.current}setIsVisible(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;e||(this.current=null),y(this.$container,"dlf-visible",e),y(this.$seekMarker,"dlf-visible",e),y(this.$seekThumbBar,"dlf-visible",i&&null!==this.snapToThumbnail),y(this.$display,"is-open",t),y(this.$img,"dlf-visible",i),function(e){e.draggable=!1,e.ondragstart=v}(this.$img)}async getThumbnails(e,t){let i=[];if(null!==this.snapToThumbnail)i=[this.snapToThumbnail];else{let e=this.thumbnailTracks.find((e=>e.bandwidth<t));if(void 0!==e){let t=this.thumbnailTracks[this.thumbnailTracks.length-1];i=e===t?[e]:[e,t]}}const s=i.map((t=>this.getSingleThumbnail(t,e)));return k(await Promise.all(s))}async getSingleThumbnail(e,t){const i=await e.getThumb(t),s=this.saneVideoDuration();return null===i||void 0===s?null:(o=s,(n=i).startTime<o&&n.imageTime<o?{...n,duration:Math.min(n.duration,o-n.startTime)}:null);var n,o}showThumbnailImage(){var e;const t=this.player.getMediaElement();return 300<=.4*(null!==(e=null==t?void 0:t.clientHeight)&&void 0!==e?e:0)}saneVideoDuration(){var e;const t=null===(e=this.player.getMediaElement())||void 0===e?void 0:e.duration;return void 0!==t&&t>0?t:void 0}}class x extends l().ui.Element{static register(){l().ui.Controls.registerSeekBar({create:(e,t)=>new x(e,t)})}constructor(e,t){var i;super(e,t),this.$container=g("div",{className:"dlf-media-flat-seek-bar"},[this.$range=g("div",{className:"range"})]),e.prepend(this.$container),this.dlf={mediaProperties:{poster:null,chapters:null,fps:null,variantGroups:null},hasRenderedChapters:!1,value:0,uiConfig:t.getConfig(),wasPlaying:!1,seekTimer:null,thumbnailPreview:null,lastGradientStr:""},this.dlf.seekTimer=new(l().util.Timer)((()=>{var e;null!==this.video&&(this.video.currentTime=this.getValue(),null===(e=this.controls)||void 0===e||e.dispatchEvent(new CustomEvent("dlf-media-manual-seek",{})))})),null!==this.player&&(this.dlf.thumbnailPreview=new S({seekBar:this.$container,player:this.player,network:new w,interaction:{onChangeStart:()=>{var e;null===(e=this.controls)||void 0===e||e.setSeeking(!0),null!==this.video&&(this.dlf.wasPlaying=!this.video.paused,this.video.pause())},onChange:e=>{var t;this.dlf.value=e.seconds,this.update(),null===(t=this.dlf.seekTimer)||void 0===t||t.tickAfter(.125)},onChangeEnd:()=>{var e,t,i;null===(e=this.dlf.seekTimer)||void 0===e||e.tickNow(),null===(t=this.controls)||void 0===t||t.setSeeking(!1),this.dlf.wasPlaying&&(null===(i=this.video)||void 0===i||i.play())}}})),this.eventManager&&(this.eventManager.listen(this.player,"loaded",(()=>{this.update()})),this.eventManager.listen(this.player,"variantchanged",(()=>{this.updatePreviewImageTracks()})),this.eventManager.listen(this.controls,"dlf-media-properties",(e=>{const t=e.detail;this.dlf.mediaProperties=t.fullProps;const{chapters:i,fps:s,variantGroups:n}=t.updateProps;var o,r,a;void 0!==i&&(this.dlf.hasRenderedChapters=!1,null===(o=this.dlf.thumbnailPreview)||void 0===o||o.setChapters(i),this.update()),void 0!==s&&(null===(r=this.dlf.thumbnailPreview)||void 0===r||r.setFps(null!==(a=null==s?void 0:s.rate)&&void 0!==a?a:null)),n&&this.updatePreviewImageTracks()})),null===(i=this.controls)||void 0===i||i.dispatchEvent(new CustomEvent("dlf-media-seek-bar",{detail:{seekBar:this}})))}release(){null!==this.dlf.seekTimer&&(this.dlf.seekTimer.stop(),this.dlf.seekTimer=null),null!==this.dlf.thumbnailPreview&&(this.dlf.thumbnailPreview.release(),this.dlf.thumbnailPreview=null),super.release()}get thumbnailPreview(){return this.dlf.thumbnailPreview}isThumbnailPreviewOpen(){var e,t;return null!==(e=null===(t=this.dlf.thumbnailPreview)||void 0===t?void 0:t.isVisible)&&void 0!==e&&e}endSeek(){var e,t;null===(e=this.dlf.thumbnailPreview)||void 0===e||e.endChange(),null===(t=this.dlf.thumbnailPreview)||void 0===t||t.setIsVisible(!1)}setThumbnailSnap(e){var t;null===(t=this.dlf.thumbnailPreview)||void 0===t||t.setThumbnailSnap(e)}renderChapterMarkers(e,t){this.$range.querySelectorAll(".dlf-media-chapter-marker").forEach((e=>{e.remove()}));for(const i of e){const e=i.timecode/t;if(!(0<=e&&e<1))continue;const s=document.createElement("span");s.className="dlf-media-chapter-marker",s.style.position="absolute",s.style.left="".concat(100*e,"%"),this.$range.append(s)}}updatePreviewImageTracks(){if(null===this.dlf.thumbnailPreview)return void console.warn("FlatSeekBar: Missing thumbnail preview");const{variantGroups:e}=this.dlf.mediaProperties;if(null===e)return;const t=e.findThumbnailTracks();this.dlf.thumbnailPreview.setThumbnailTracks(t)}getValue(){return this.dlf.value}isShowing(){return!0}setValue(e){var t;null!==(t=this.controls)&&void 0!==t&&t.isSeeking()||(this.dlf.value=e)}makeColor(e,t){return"".concat(e," ").concat(100*t,"%")}update(){if(null===this.video)return void console.warn("FlatSeekBar: Missing video");const e=this.video.duration;if(!(e>0))return;const{chapters:t}=this.dlf.mediaProperties;null==t||this.dlf.hasRenderedChapters||(this.renderChapterMarkers(t,e),this.dlf.hasRenderedChapters=!0);const i=getComputedStyle(this.$container),s={base:i.getPropertyValue("--base-color")||"rgba(255, 255, 255, 0.3)",buffered:i.getPropertyValue("--buffered-color")||"rgba(255, 255, 255, 0.54)",played:i.getPropertyValue("--played-color")||"rgb(255, 255, 255)"},n=this.getValue(),o=this.video.buffered.length,r=o?this.video.buffered.start(0):0,a=o?this.video.buffered.end(o-1):0,l={start:0,end:e},h=l.end-l.start,d=Math.max(r,l.start),c=Math.min(a,l.end),u=Math.min(Math.max(n,l.start),l.end),p=(d-l.start)/h||0,m=(c-l.start)/h||0,v=(u-l.start)/h||0,f=this.dlf.uiConfig.showUnbufferedStart?s.base:s.played,g="linear-gradient("+["to right",this.makeColor(f,p),this.makeColor(s.played,p),this.makeColor(s.played,v),this.makeColor(s.buffered,v),this.makeColor(s.buffered,m),this.makeColor(s.base,m)].join(",")+")";g!==this.dlf.lastGradientStr&&(this.dlf.lastGradientStr=g,this.$range.style.background=g)}}class M extends b{constructor(e,t,i){super(e,t,i,{...arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},className:"shaka-fullscreen-button shaka-tooltip"}),this.eventManager&&this.eventManager.listen(document,"fullscreenchange",this.updateFullScreenButton.bind(this)),this.updateFullScreenButton()}updateControlPanelButton(){}updateFullScreenButton(){document.fullscreenEnabled?(this.dlf.button.textContent=document.fullscreenElement?"fullscreen_exit":"fullscreen",this.dlf.button.ariaLabel=document.fullscreenElement?this.env.t("control.fullscreen_exit.tooltip"):this.env.t("control.fullscreen.tooltip")):this.dlf.button.classList.add("shaka-hidden")}}l().ui.SettingsMenu;class E extends l().ui.Element{static register(e){const t=e.mkid();return l().ui.Controls.registerElement(t,{create:(t,i)=>new E(t,i,e)}),t}constructor(e,t,i){super(e,t);const s=g("button",{className:"shaka-current-time shaka-tooltip",ariaLabel:i.t("control.time.tooltip")});if(e.appendChild(s),this.dlf={env:i,currentTime:s},this.state={isReady:!1,activeMode:0,totalSeconds:0,duration:0,mediaProperties:{chapters:null,fps:null}},this.eventManager){this.eventManager.listen(s,"click",(()=>{this.render({activeMode:(this.state.activeMode+1)%3})}));const e=this.updateTime.bind(this);this.eventManager.listen(this.controls,"timeandseekrangeupdated",e),this.eventManager.listen(this.controls,"dlf-media-properties",(e=>{const t=e.detail;this.render({mediaProperties:t.fullProps})}))}}updateTime(){if(null===this.controls||null===this.video||this.video.readyState<1)this.render({isReady:!1});else{let e=this.video.duration;e>=0||(e=0),this.render({isReady:!0,duration:e,totalSeconds:h(this.controls.getDisplayTime(),[0,e])})}}render(e){const t=Object.assign({},this.state,e);if(Object.keys(e).some((t=>e[t]!==this.state[t]))){var i;const e=null!==(i={0:"current-time",1:"remaining-time",2:"current-frame"}[t.activeMode])&&void 0!==i?i:"current-time";this.dlf.currentTime.textContent=this.getTimecodeText(e,t)}this.state=t}getTimecodeText(e,t){let{isReady:i,totalSeconds:s,duration:n,mediaProperties:o}=t;if(i&&0!==n){var r;const t=n>=3600,{chapters:i,fps:a}=o,l=null!==(r=null==a?void 0:a.rate)&&void 0!==r?r:null,h={get chapterTitle(){var e,t;return null!==(e=null==i||null===(t=i.timeToChapter(s))||void 0===t?void 0:t.title)&&void 0!==e?e:"_"},get currentTime(){return T(s,t,l)},get totalTime(){return T(n,t,l)},get remainingTime(){return T(n-s,t,l)},get currentFrame(){var e;return null!==(e=null==a?void 0:a.vifa.get())&&void 0!==e?e:-1}};return this.dlf.env.t("control.time.".concat(e,".text"),h)}return this.dlf.env.t("player.loading")}}class B{constructor(e,t){this.player=e,this.track=t}get bandwidth(){return this.track.bandwidth}async getThumb(e){const t=await this.player.getThumbnails(this.track.id,e);return null===t?null:{track:this,...t,imageTime:t.startTime+t.duration/2-1e-5,bandwidth:this.track.bandwidth}}}class L{constructor(e){if(this.player=e,this.manifest=e.getManifest(),this.groupKeys=[],this.groups=[],this.keyToGroup={},null!==this.manifest)for(const e of this.manifest.variants)this.addVariant(e);else console.warn("Manifest not available")}static splitRepresentationId(e){var t,i;const s=(null!=e?e:"").split("#");return{id:null!==(t=s[0])&&void 0!==t?t:null,group:null!==(i=s[1])&&void 0!==i?i:"Standard"}}addVariant(e){const t=e.video;if(t){const i=L.splitRepresentationId(t.originalId).group,s=this.getGroupOrCreate(i);s.variants.push(e);for(const e of t.roles)s.roles.add(e);t.primary&&(s.hasPrimary=!0)}}get numGroups(){return this.groupKeys.length}getGroupOrCreate(e){let t=this.keyToGroup[e];return t||(t=this.keyToGroup[e]={key:e,variants:[],roles:new Set,hasPrimary:!1},this.groupKeys.push(e),this.groups.push(t)),t}findActiveTrack(){return this.player.getVariantTracks().find((e=>e.active))}findThumbnailTracks(){var e;const t=[],i=null===(e=this.findActiveGroup())||void 0===e?void 0:e.key;for(const e of this.player.getImageTracks())L.splitRepresentationId(e.originalImageId).group===i&&t.push(new B(this.player,e));return t}findActiveGroup(){const e=this.findActiveTrack();if(e){const t=L.splitRepresentationId(e.originalVideoId).group;return this.keyToGroup[t]}}selectGroup(e){if(this.manifest){if(this.manifest.variants!==e.variants){var t;const i=this.findActiveTrack();this.manifest.variants=e.variants,this.player.selectAudioLanguage(null!==(t=null==i?void 0:i.language)&&void 0!==t?t:"und")}}else console.warn("Cannot select group: Manifest not available")}trySelectGroup(e){return!!e&&(this.selectGroup(e),!0)}selectGroupByKey(e){return this.trySelectGroup(this.keyToGroup[e])}selectGroupByIndex(e){return this.trySelectGroup(this.groups[e])}selectGroupByRole(e){return this.trySelectGroup(this.groups.find((t=>t.roles.has(e))))}selectGroupWithPrimary(){return this.trySelectGroup(this.groups.find((e=>e.hasPrimary)))}*[Symbol.iterator](){for(const e in this.keyToGroup)yield this.keyToGroup[e]}}class A extends l().ui.SettingsMenu{static register(e){const t=e.mkid();return l().ui.OverflowMenu.registerElement(t,{create:(t,i)=>new A(t,i,e)}),t}constructor(e,t,i){super(e,t,"switch_video"),this.dlf={env:i,activeCheck:g("i",{className:"material-icons-round shaka-chosen-item"},["done"]),variantGroups:null},this.updateStrings(),this.updateVisibility(),this.menuButtons={},this.eventManager&&(this.eventManager.listen(this.controls,"dlf-media-properties",(e=>{const t=e.detail,{variantGroups:i}=t.updateProps;if(void 0!==i)try{this.setVariantGroups(i)}catch(e){console.error(e)}})),this.eventManager.listen(this.player,"variantchanged",(()=>{this.markActiveGroup()})))}setVariantGroups(e){if(this.dlf.variantGroups=e,this.clearMenu(),this.updateVisibility(),null!==e){for(const t of e){const e=g("button",{$click:()=>{var e;null===(e=this.dlf.variantGroups)||void 0===e||e.selectGroupByKey(t.key)}},[g("span",{},[t.key])]);this.menu.appendChild(e),this.menuButtons[t.key]=e}this.markActiveGroup()}}clearMenu(){for(const e of Object.values(this.menuButtons))e.remove();this.menuButtons={}}markActiveGroup(){var e;const t=null===(e=this.dlf.variantGroups)||void 0===e?void 0:e.findActiveGroup();var i;t&&(null===(i=this.menuButtons[t.key])||void 0===i||i.appendChild(this.dlf.activeCheck),this.currentSelection.textContent=t.key)}updateVisibility(){var e,t;(null!==(e=null===(t=this.dlf.variantGroups)||void 0===t?void 0:t.numGroups)&&void 0!==e?e:0)>0?this.button.classList.remove("shaka-hidden"):this.button.classList.add("shaka-hidden")}updateStrings(){const e=this.dlf.env.t("control.back"),t=this.dlf.env.t("control.video-track.title");this.backButton.ariaLabel=e,this.button.ariaLabel=t,this.nameSpan.textContent=t,this.backSpan.textContent=t}}function $(e){return"function"==typeof e?{isAvailable:()=>!0,execute:e}:{isAvailable:null!==(t=e.isAvailable)&&void 0!==t?t:()=>!0,execute:null!==(i=e.execute)&&void 0!==i?i:()=>{}};var t,i}var N=i(942),I=function(e){if(this===window)return new I(e);this.obj=e||{},this.frameRate=this.obj.frameRate||24,this.video=document.getElementById(this.obj.id)||document.getElementsByTagName("video")[0]};I.prototype={get:function(){return Math.floor(this.video.currentTime.toFixed(5)*this.frameRate)},listen:function(e,t){var i=this;e?this.interval=setInterval((function(){if(!i.video.paused&&!i.video.ended){var t="SMPTE"===e?i.toSMPTE():"time"===e?i.toTime():i.get();return i.obj.callback&&i.obj.callback(t,e),t}}),t||1e3/i.frameRate/2):console.log("VideoFrame: Error - The listen method requires the format parameter.")},stopListen:function(){clearInterval(this.interval)},fps:{film:24,NTSC:29.97,NTSC_Film:23.98,NTSC_HD:59.94,PAL:25,PAL_HD:50,web:30,high:60}},I.prototype.toTime=function(e){var t="number"!=typeof e?this.video.currentTime:e,i=this.frameRate,s=new Date,n="hh:mm:ss"+("number"==typeof e?":ff":"");function o(e){return e<10?"0"+e:e}return s.setHours(0),s.setMinutes(0),s.setSeconds(0),s.setMilliseconds(1e3*t),n.replace(/hh|mm|ss|ff/g,(function(e){switch(e){case"hh":return o(s.getHours()<13?s.getHours():s.getHours()-12);case"mm":return o(s.getMinutes());case"ss":return o(s.getSeconds());case"ff":return o(Math.floor(t%1*i))}}))},I.prototype.toSMPTE=function(e){if(!e)return this.toTime(this.video.currentTime);var t=Number(e),i=this.frameRate;function s(e){return e<10?"0"+e:e}var n=60*i,o=(t/(60*i*60)).toFixed(0),r=Number((t/n).toString().split(".")[0])%60,a=Number((t/i).toString().split(".")[0])%60;return s(o)+":"+s(r)+":"+s(a)+":"+s(t%i)},I.prototype.toSeconds=function(e){if(!e)return Math.floor(this.video.currentTime);var t=e.split(":");return 60*Number(t[0])*60+60*Number(t[1])+Number(t[2])},I.prototype.toMilliseconds=function(e){var t=Number(e?e.split(":")[3]:this.toSMPTE().split(":")[3]),i=1e3/this.frameRate*(isNaN(t)?0:t);return Math.floor(1e3*this.toSeconds(e)+i)},I.prototype.toFrames=function(e){var t=e?e.split(":"):this.toSMPTE().split(":"),i=this.frameRate,s=60*Number(t[0])*60*i,n=60*Number(t[1])*i,o=Number(t[2])*i,r=Number(t[3]);return Math.floor(s+n+o+r)},I.prototype.__seek=function(e,t){this.video.paused||this.video.pause();var i=Number(this.get());this.video.currentTime=("backward"===e?i-t:i+t)/this.frameRate+1e-5},I.prototype.seekForward=function(e,t){return e||(e=1),this.__seek("forward",Number(e)),!t||t()},I.prototype.seekBackward=function(e,t){return e||(e=1),this.__seek("backward",Number(e)),!t||t()},I.prototype.seekTo=function(e){var t,i,s=e||{},n=Object.keys(s)[0];if("SMPTE"==n||"time"==n)return i=s[n],t=this.toMilliseconds(i)/1e3+.001,void(this.video.currentTime=t);switch(n){case"frame":i=this.toSMPTE(s[n]),t=this.toMilliseconds(i)/1e3+.001;break;case"seconds":t=Number(s[n]);break;case"milliseconds":t=Number(s[n])/1e3+.001}isNaN(t)||(this.video.currentTime=t)};var R=I,F=i(15);class O{constructor(){this.idCnt=0,this.testElements={},this.lang={twoLetterIsoCode:"en",phrasesInput:{},phrasesCompiled:{}}}getLocation(){return new URL(window.location.href)}supportsMediaSource(){return void 0!==window.MediaSource&&void 0!==window.MediaSource.isTypeSupported}supportsCanvasExport(e){var t,i;return(t=this.getTestElement("canvas").toDataURL(e),null===(i=t.match(/data:(.*);/))||void 0===i?void 0:i[1])===e}supportsVideoMime(e){return""!==this.getTestElement("video").canPlayType(e)}isInFullScreen(){return null!==document.fullscreenElement}async toggleFullScreen(e,t){if(document.fullscreenElement)screen.orientation&&screen.orientation.unlock(),await document.exitFullscreen();else try{if(document.pictureInPictureElement&&await document.exitPictureInPicture(),await e.requestFullscreen({navigationUI:"hide"}),t&&screen.orientation)try{await screen.orientation.lock("landscape")}catch(e){}}catch(e){console.log(e)}}mkid(){return"__autoid_".concat(++this.idCnt)}setLang(e){this.lang={twoLetterIsoCode:e.twoLetterIsoCode,phrasesInput:e.phrases,phrasesCompiled:{}}}t(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,s=this.lang.phrasesCompiled[e];if(void 0===s){const t=this.lang.phrasesInput[e];if(void 0===t)return"function"==typeof i?i():(console.error("Warning: Translation key '".concat(e,"' not defined, fallback not provided.")),e);s=this.lang.phrasesCompiled[e]=new F.ZP(t,this.lang.twoLetterIsoCode)}return s.format(t)}getTestElement(e){var t;return null!==(t=this.testElements[e])&&void 0!==t?t:document.createElement(e)}}var D=i(187),G=i.n(D);class U{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.config={tapMaxDelay:500,tapMaxDistance:20,swipeMinDistance:100,holdMinDelay:200,allowGesture:()=>!0,...e},this.last={tapdown:null,tapup:null},this.holdTimeout=null,this.tapCount=0,this.handlers={contextmenu:this.handleContextMenu.bind(this),pointerdown:this.handlePointerDown.bind(this),pointerup:this.handlePointerUp.bind(this),pointercancel:this.handlePointerCancel.bind(this),pointerleave:this.handlePointerLeave.bind(this)},this.events=new(G())}register(e){e.addEventListener("contextmenu",this.handlers.contextmenu),e.addEventListener("pointerdown",this.handlers.pointerdown),e.addEventListener("pointerup",this.handlers.pointerup),e.addEventListener("pointercancel",this.handlers.pointercancel),e.addEventListener("pointerleave",this.handlers.pointerleave)}deregister(e){e.removeEventListener("contextmenu",this.handlers.contextmenu),e.removeEventListener("pointerdown",this.handlers.pointerdown),e.removeEventListener("pointerup",this.handlers.pointerup),e.removeEventListener("pointercancel",this.handlers.pointercancel),e.removeEventListener("pointerleave",this.handlers.pointerleave)}on(e,t){this.events.on(e,t)}handleContextMenu(e){this.release()}handlePointerDown(e){if(0!==e.button||!this.config.allowGesture(e))return void this.release();const t=this.getStat(e);"tap"===this.getContinuation(this.last.tapup,t)?this.tapCount++:this.tapCount=1;const i=this.tapCount;this.clearHold(),this.holdTimeout=setTimeout((()=>{this.events.emit("gesture",{type:"hold",event:e,position:t.positionRel,tapCount:i})}),this.config.holdMinDelay),this.emitTap("tapdown",e,t)}handlePointerUp(e){if(0!==e.button||!this.config.allowGesture(e))return;const t=this.getStat(e);this.clearHold();const i=this.getContinuation(this.last.tapdown,t);if("tap"===i)this.emitTap("tapup",e,t);else if(1===this.tapCount&&"swipe"===i){const i=this.last.tapdown,s=t,n=Math.atan2(i.positionPx.y-s.positionPx.y,s.positionPx.x-i.positionPx.x),o=Math.abs(n/Math.PI*180);let r;r=o<45?"east":o<135?n>0?"north":"south":"west",this.events.emit("gesture",{type:"swipe",event:e,begin:i.positionRel,end:s.positionRel,angle:n,direction:r}),this.reset()}else this.release()}handlePointerCancel(e){this.release()}handlePointerLeave(e){const{tapdown:t,tapup:i}=this.last;(null===t||null!==i&&t.date>i.date)&&this.release()}emitTap(e,t,i){this.events.emit("gesture",{type:e,event:t,position:i.positionRel,tapCount:this.tapCount}),this.last[e]=i}release(){const e=this.isActive;this.reset(),e&&this.events.emit("release")}reset(){this.tapCount=0,this.clearHold(),this.last={tapdown:null,tapup:null}}get isActive(){return 0!==this.tapCount||null!==this.last.tapdown||null!==this.last.tapup}getStat(e){const t=e.target.getBoundingClientRect(),i={x:e.clientX,y:e.clientY},s={x:e.screenX||i.x,y:e.screenY||i.y},n={x:(i.x-t.left)/t.width,y:(i.y-t.top)/t.height};return{date:new Date,positionClientPx:i,positionPx:s,positionRel:n}}getContinuation(e,t){if(null===e)return"tap";if(t.date.valueOf()-e.date.valueOf()>this.config.tapMaxDelay)return"cancel";const i=(t.positionPx.x-e.positionPx.x)**2+(t.positionPx.y-e.positionPx.y)**2;return i<=this.config.tapMaxDistance**2?"tap":i>=this.config.swipeMinDistance**2?"swipe":"cancel"}clearHold(){null!==this.holdTimeout&&(clearTimeout(this.holdTimeout),this.holdTimeout=null)}}class _{constructor(e,t,i){this.constants={minBottomControlsReadyState:2},this.env=e,this.player=t,this.media=i,this.mediaProperties={poster:null,chapters:null,fps:null,variantGroups:null},this.lastReadyState=0,this.playerProperties={mode:"audio",locale:"",state:"poster",error:null},this.controlPanelButtons=[],this.overflowMenuButtons=[],this.shakaBottomControls=null,this.seekBar_=null,this.$container=g("div",{className:"dlf-media-player dlf-shaka"},[this.$videoBox=g("div",{className:"dlf-media-shaka-box"},[this.$video=i,this.$poster=g("img",{className:"dlf-media-poster dlf-visible",$error:()=>{this.hidePoster()}})]),this.$errorBox=g("div",{className:"dlf-media-shaka-box dlf-media-error"})]),this.ui=new(l().ui.Overlay)(this.player,this.$videoBox,this.media),this.controls=this.ui.getControls(),this.configureTimeout=null,this.isConfigured=!1,this.gestures_=new U({allowGesture:this.allowGesture.bind(this)}),this.handlers={onControlsErrorEvent:this.onControlsErrorEvent.bind(this),onPlay:this.onPlay.bind(this),onTimeUpdate:this.onTimeUpdate.bind(this),afterManualSeek:this.afterManualSeek.bind(this)},this.registerEventHandlers(),this.scheduleConfigure()}registerEventHandlers(){this.controls.addEventListener("error",this.handlers.onControlsErrorEvent),this.controls.addEventListener("dlf-media-seek-bar",(e=>{const t=e.detail;this.seekBar_=t.seekBar,this.autosetSeekMode()})),this.controls.addEventListener("dlf-media-manual-seek",this.handlers.afterManualSeek),this.controls.addEventListener("timeandseekrangeupdated",this.handlers.onTimeUpdate),this.media.addEventListener("play",this.handlers.onPlay),this.gestures_.register(this.$videoBox)}get domElement(){return this.$container}get seekBar(){return this.seekBar_}get gestures(){return this.gestures_}updateMediaProperties(e){Object.assign(this.mediaProperties,e),this.notifyMediaProperties(this.mediaProperties,e)}notifyMediaProperties(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.mediaProperties,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;void 0!==t.poster&&this.renderPoster();const i=new CustomEvent("dlf-media-properties",{detail:{updateProps:t,fullProps:e}});this.controls.dispatchEvent(i)}updatePlayerProperties(e){const t=void 0!==e.mode&&(!this.isConfigured||e.mode!==this.playerProperties.mode);var i;Object.assign(this.playerProperties,e),void 0!==e.locale&&(null===(i=this.controls.getLocalization())||void 0===i||i.changeLocale([e.locale])),void 0!==e.state&&this.renderPoster(),void 0!==e.error&&this.renderError(),t&&this.scheduleConfigure()}handleEscape(){var e,t;return null!==(e=this.seekBar)&&void 0!==e&&e.isThumbnailPreviewOpen()?(null===(t=this.seekBar)||void 0===t||t.endSeek(),!0):!!this.controls.anySettingsMenusAreOpen()&&(this.controls.hideSettingsMenus(),!0)}afterManualSeek(){this.hidePoster()}addControlElement(){this.controlPanelButtons.push(...arguments),this.scheduleConfigure()}addOverflowButton(){this.overflowMenuButtons.push(...arguments),this.scheduleConfigure()}scheduleConfigure(){null===this.configureTimeout&&(this.configureTimeout=setTimeout((()=>{this.configureTimeout=null,this.configure()})))}configure(){x.register(),this.$container.setAttribute("data-mode",this.playerProperties.mode),this.ui.configure(this.getShakaConfiguration()),this.isConfigured=!0,this.autosetSeekMode(),this.$videoBox.dispatchEvent(new MouseEvent("mousemove")),this.shakaBottomControls=this.$videoBox.querySelector(".shaka-bottom-controls"),this.notifyMediaProperties()}autosetSeekMode(){var e,t;const i="audio"===this.playerProperties.mode?"narrow":"wide";null===(e=this.seekBar_)||void 0===e||null===(t=e.thumbnailPreview)||void 0===t||t.setSeekMode(i)}getShakaConfiguration(){const e=this.playerProperties.mode,t=getComputedStyle(this.$container);return{addSeekBar:!0,enableTooltips:!0,controlPanelElements:["play_pause",E.register(this.env),"spacer","volume","mute",...this.controlPanelButtons,"overflow_menu"],overflowMenuButtons:["language",A.register(this.env),"playback_rate","loop","quality","picture_in_picture","captions",...this.overflowMenuButtons],addBigPlayButton:"video"===e,fadeDelay:"audio"===e?1e8:void 0,volumeBarColors:{base:t.getPropertyValue("--volume-base-color")||"rgba(255, 255, 255, 0.54)",level:t.getPropertyValue("--volume-level-color")||"rgb(255, 255, 255)"},enableKeyboardPlaybackControls:!1,doubleClickForFullscreen:!1,singleClickForPlayAndPause:!1}}hidePoster(){this.$poster.classList.remove("dlf-visible")}renderPoster(){const e=null!==this.mediaProperties.poster&&"poster"===this.playerProperties.state;e&&(this.$poster.src=this.mediaProperties.poster),y(this.$poster,"dlf-visible",e)}renderError(){null===this.playerProperties.error?y(this.$errorBox,"dlf-visible",!1):(y(this.$errorBox,"dlf-visible",!0),this.$errorBox.textContent=this.env.t(this.playerProperties.error))}allowGesture(e){var t,i;const s=this.$videoBox.getBoundingClientRect(),n=null!==(t=null===(i=this.shakaBottomControls)||void 0===i?void 0:i.getBoundingClientRect().height)&&void 0!==t?t:0,o=s.bottom-n-20;return!(e.clientY>=o)&&e.target===this.$videoBox.querySelector(".shaka-play-button-container")}onControlsErrorEvent(e){if(e instanceof CustomEvent){const t=e.detail;console.error("Error from Shaka controls",t.code,t)}}onPlay(){this.hidePoster()}onTimeUpdate(){const e=this.media.readyState;e!==this.lastReadyState&&this.updateBottomControlsVisibility(e)}updateBottomControlsVisibility(e){var t;if(0===e)null===(t=this.shakaBottomControls)||void 0===t||t.classList.remove("dlf-visible");else if(e>=this.constants.minBottomControlsReadyState){var i;null===(i=this.shakaBottomControls)||void 0===i||i.classList.add("dlf-visible")}}}function V(e){return"audio"===e||"video"===e}class j extends HTMLElement{constructor(){super(),j.hasInstalledPolyfills||(l().polyfill.installAll(),j.hasInstalledPolyfills=!0),this.config=null,this.env=new O,this.constants=this.constantDefaults(),this.dlf={handlers:{onDomContentLoaded:this.onDomContentLoaded.bind(this),onPlayerErrorEvent:this.onPlayerErrorEvent.bind(this),onTrackChange:this.onTrackChange.bind(this),onPlay:this.onPlay.bind(this)}},this.video=g("video",{id:this.env.mkid(),className:"dlf-media"}),this.videoPausedOn=null,this.currentSource=null,this.startTime=null,this.player=new(l().Player)(this.video),this.fps=null,this.variantGroups=null,this.chapters=new r([]),this.frontend=new _(this.env,this.player,this.video),this.mode="auto",this.__dlfRegisterEvents(),this.actions=this.getActions()}connectedCallback(){const e=this.getConfig();this.env.setLang(e.lang),this.startTime=this.getStartTime(),this.configureFrontend(e),setTimeout((()=>{this.loadSources(),this.loadChapters()})),this.appendChild(this.frontend.domElement),this.frontend.domElement.className+=" ".concat(this.className)}configureFrontend(e){const t=this.getAttribute("mode");let i;if("auto"===t){const e=this.getAttribute("mode-fallback");V(e)&&(i=e),this.mode=t}else V(t)&&(this.mode=i=t);this.frontend.updatePlayerProperties({locale:e.lang.twoLetterIsoCode,mode:i});const s=this.getAttribute("poster");null!==s&&this.frontend.updateMediaProperties({poster:s})}getConfig(){let e=this.config;if(null===e){const t=this.getAttribute("config");e=t?window[t]:{lang:{locale:"en_US.UTF8",twoLetterIsoCode:"en",phrases:{}}},this.config=e}return e}constantDefaults(){return{prevChapterTolerance:5,volumeStep:.05,seekStep:5,trickPlayFactor:4}}getActions(){return{"fullscreen.toggle":$({isAvailable:()=>document.fullscreenEnabled,execute:()=>{var e;null===(e=this.frontend.seekBar)||void 0===e||e.endSeek(),this.toggleFullScreen()}}),"playback.toggle":$((()=>{this.video.paused?this.video.play():this.video.pause()})),"playback.volume.mute.toggle":$((()=>{this.video.muted=!this.video.muted})),"playback.volume.inc":$((()=>{this.volume=this.volume+this.constants.volumeStep})),"playback.volume.dec":$((()=>{this.volume=this.volume-this.constants.volumeStep})),"playback.captions.toggle":$({isAvailable:()=>this.player.getTextTracks().length>0,execute:()=>{this.showCaptions=!this.showCaptions}}),"navigate.rewind":$((()=>{this.skipSeconds(-this.constants.seekStep)})),"navigate.seek":$((()=>{this.skipSeconds(+this.constants.seekStep)})),"navigate.continuous-rewind":$((()=>{this.ensureTrickPlay(-this.constants.trickPlayFactor)})),"navigate.continuous-seek":$((()=>{this.ensureTrickPlay(this.constants.trickPlayFactor)})),"navigate.chapter.prev":$((()=>{this.prevChapter()})),"navigate.chapter.next":$((()=>{this.nextChapter()})),"navigate.frame.prev":$({isAvailable:()=>null!==this.fps,execute:()=>{var e;null===(e=this.fps)||void 0===e||e.vifa.seekBackward(1),this.frontend.afterManualSeek()}}),"navigate.frame.next":$({isAvailable:()=>null!==this.fps,execute:()=>{var e;null===(e=this.fps)||void 0===e||e.vifa.seekForward(1),this.frontend.afterManualSeek()}}),"navigate.position.percental":$(((e,t)=>{if(void 0!==e&&void 0!==t&&0<=t&&t<e.keys.length){const i=t/e.keys.length*this.video.duration;this.seekTo(i)}})),"navigate.thumbnails.snap":$({isAvailable:()=>null!==this.variantGroups&&this.variantGroups.findThumbnailTracks().length>0,execute:(e,t,i)=>{var s;null===(s=this.frontend.seekBar)||void 0===s||s.setThumbnailSnap("down"===i)}})}}getStartTime(){const e=this.getAttribute("start");return null===e||""===e?null:Number(e)}__dlfRegisterEvents(){window.addEventListener("DOMContentLoaded",this.dlf.handlers.onDomContentLoaded),this.player.addEventListener("error",this.dlf.handlers.onPlayerErrorEvent),this.player.addEventListener("adaptation",this.dlf.handlers.onTrackChange),this.player.addEventListener("variantchanged",this.dlf.handlers.onTrackChange),this.video.addEventListener("play",this.dlf.handlers.onPlay),this.registerGestures()}registerGestures(){const e=this.frontend.gestures;null!==e&&(e.on("gesture",(e=>{switch(e.type){case"tapup":"mouse"===e.event.pointerType?(e.tapCount<=2&&this.actions["playback.toggle"].execute(),2===e.tapCount&&this.actions["fullscreen.toggle"].execute()):e.tapCount>=2&&(e.position.x<1/3?this.actions["navigate.rewind"].execute():e.position.x>2/3?this.actions["navigate.seek"].execute():2!==e.tapCount||this.env.isInFullScreen()||this.actions["fullscreen.toggle"].execute());break;case"hold":var t,i;1===e.tapCount?null===(t=this.frontend.seekBar)||void 0===t||null===(i=t.thumbnailPreview)||void 0===i||i.beginChange(e.event.clientX):e.tapCount>=2&&(e.position.x<1/3?this.actions["navigate.continuous-rewind"].execute():e.position.x>2/3&&this.actions["navigate.continuous-seek"].execute());break;case"swipe":"east"===e.direction?this.actions["navigate.rewind"].execute():"west"===e.direction&&this.actions["navigate.seek"].execute()}})),e.on("release",(()=>{var e;null===(e=this.frontend.seekBar)||void 0===e||e.endSeek(),this.cancelTrickPlay()})))}get ui(){return this.frontend}supportsMimeType(e){switch(e){case"application/dash+xml":case"application/x-mpegurl":case"application/vnd.apple.mpegurl":return this.env.supportsMediaSource()||this.env.supportsVideoMime(e);default:return this.env.supportsVideoMime(e)}}loadSources(){const e=[];this.querySelectorAll("source").forEach((t=>{const i=t.getAttribute("src"),s=t.getAttribute("type");i&&s?e.push({url:i,mimeType:s}):console.warn("Ignoring <source> that does not specify URL or MIME type")})),this.loadOneOf(e)}async loadOneOf(e){if(0===e.length)return this.frontend.updatePlayerProperties({error:"error.no-media-source"}),!1;let t=!1;for(const i of e)if(this.supportsMimeType(i.mimeType))try{return await this.loadManifest(i),this.frontend.updatePlayerProperties({error:null,mode:"auto"===this.mode?this.player.isAudioOnly()?"audio":"video":void 0}),this.loaded(),!0}catch(e){console.error(e)}else t=!0;return this.frontend.updatePlayerProperties({error:t?"error.playback-not-supported":"error.load-failed"}),!1}async loadManifest(e){await this.player.load(e.url,this.startTime,e.mimeType),this.currentSource=e,this.variantGroups=new L(this.player),this.variantGroups.selectGroupWithPrimary()||this.variantGroups.selectGroupByRole("main")||this.variantGroups.selectGroupByIndex(0),this.frontend.updateMediaProperties({variantGroups:this.variantGroups}),this.updateFrameRate()}onDomContentLoaded(){}onTrackChange(){this.updateFrameRate()}updateFrameRate(){var e,t,i;const s=null!==(e=null===(t=this.variantGroups)||void 0===t||null===(i=t.findActiveTrack())||void 0===i?void 0:i.frameRate)&&void 0!==e?e:null;null===s?this.fps=null:null!==this.fps&&s===this.fps.rate||(this.fps={rate:s,vifa:new R({id:this.video.id,frameRate:s})}),this.frontend.updateMediaProperties({fps:this.fps})}onPlay(){this.videoPausedOn=null}async toggleFullScreen(){this.env.toggleFullScreen(this.frontend.domElement,!0)}loadChapters(){const e=[];this.querySelectorAll("dlf-chapter").forEach((t=>{const i=t.getAttribute("title"),s=Number(t.getAttribute("timecode"));i&&s>=0?e.push({title:i,timecode:s}):console.warn("Ignoring invalid <dlf-chapter>")})),this.setChapters(new r(e))}setChapters(e){this.chapters=e,this.frontend.updateMediaProperties({chapters:e})}loaded(){}get hasVideo(){return null!==this.currentSource}getCurrentChapter(){return this.timeToChapter(this.video.currentTime)}timeToChapter(e){return this.chapters.timeToChapter(e)}get media(){return this.video}get hasCurrentData(){return this.video.readyState>=2}get showCaptions(){return this.player.isTextTrackVisible()}set showCaptions(e){this.player.setTextTrackVisibility(e)}isAudioOnly(){return this.player.isAudioOnly()}get volume(){return this.video.volume}set volume(e){this.video.volume=h(e,[0,1])}get displayTime(){var e,t;return null!==(e=null===(t=this.frontend.seekBar)||void 0===t?void 0:t.getValue())&&void 0!==e?e:this.video.currentTime}pauseOn(e){null!==this.videoPausedOn||this.video.paused||(this.videoPausedOn=e,this.video.pause())}resumeOn(e){this.videoPausedOn===e&&this.video.play()}getFps(){var e,t;return null!==(e=null===(t=this.fps)||void 0===t?void 0:t.rate)&&void 0!==e?e:null}seekTo(e){"number"==typeof e?this.video.currentTime=e:"number"==typeof e.timecode&&(this.video.currentTime=e.timecode),this.frontend.afterManualSeek()}skipSeconds(e){this.seekTo(this.video.currentTime+e)}prevChapter(){const e=this.constants.prevChapterTolerance,t=this.chapters.timeToChapter(this.video.currentTime-e);this.seekTo(null!=t?t:0)}nextChapter(){const e=this.getCurrentChapter();if(e){const t=this.chapters.advance(e,1);t&&this.seekTo(t)}}ensureTrickPlay(e){this.player.getPlaybackRate()!==e&&this.player.trickPlay(e)}cancelTrickPlay(){try{return this.player.cancelTrickPlay(),!0}catch(e){return!1}}onPlayerErrorEvent(e){if(e instanceof CustomEvent){const t=e.detail;console.error("Error from Shaka player",t.code,t)}}}(0,N.Z)(j,"hasInstalledPolyfills",!1),customElements.define("dlf-media",j),window.DlfMediaPlayer=j;var K=i(592);function q(e,t){const i=t.getLocation();return null!=e&&0!==e?i.searchParams.set("timecode",e.toString()):i.searchParams.delete("timecode"),i}var z=jQuery,H=i.n(z);class W extends(G()){constructor(e){super(),this.state=e,this.pendingStateUpdates=[],this.renderTimeout=null,this.renderPromise=Promise.resolve()}setState(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t="function"==typeof e?e:()=>e;this.pendingStateUpdates.push(t),this.renderTimeout||(this.renderPromise=new Promise((e=>{this.renderTimeout=setTimeout((()=>{const t=this.squashStateUpdates();this.render(t),this.state=t,this.renderTimeout=null,this.renderPromise=Promise.resolve(),this.emit("updated",t),e()}))})))}update(){return this.renderPromise}squashStateUpdates(){const e=Object.assign({},this.state);for(const t of this.pendingStateUpdates)Object.assign(e,t(e));return this.pendingStateUpdates=[],e}render(e){}}class X extends W{constructor(e,t){super({show:!1,...t}),this.parent=e,this.isAnimating=!1,this.$main=g("div",{className:"sxnd-modal"},[this.$headline=g("div",{className:"headline-container"},[this.$title=g("h3"),this.$close=g("span",{className:"modal-close material-icons-round",$click:this.close.bind(this)},["close"])]),this.$body=g("div",{className:"body-container"})]),this.parent.append(this.$main),this.jqMain=H()(this.$main),this.resize()}resize(){this.$body.style.maxHeight="calc(".concat(this.parent.clientHeight,"px - 11rem)")}get isOpen(){return this.state.show}open(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isAnimating||this.setState({show:e})}close(){this.open(!1)}toggle(){this.open(!this.state.show)}render(e){const{show:t}=e;if(t!==this.state.show){this.isAnimating=!0;const e=t?"show":"hide";this.jqMain[e]({duration:"fast",complete:()=>{this.isAnimating=!1}})}}}class Q extends X{constructor(e,t,i){var s;super(e,{timecode:null,fps:0,startAtTimecode:!0,showQrCode:!1}),this.lastRenderedUrl=null,this.handlers={handleClickShareButton:this.handleClickShareButton.bind(this)},this.env=t,this.$main.classList.add("bookmark-modal"),this.$title.innerText=this.env.t("modal.bookmark.title");const n=this.env.mkid(),o=(null!==(s=i.shareButtons)&&void 0!==s?s:[]).map(this.createShareButton.bind(this));this.shareButtons=k(o),this.$body.append(g("div",{},[this.shareButtons.length>0&&g("div",{className:"share-buttons"},this.shareButtons.map((e=>e.element))),g("div",{className:"url-line"},[this.$urlInput=g("input",{type:"url",readOnly:!0,value:location.href}),g("a",{href:"javascript:void(0)",className:"copy-to-clipboard",title:this.env.t("modal.bookmark.copy-link"),$click:this.handleCopyToClipboard.bind(this)},[g("i",{className:"material-icons-round"},["content_copy"])])]),this.$startAt=g("div",{className:"start-at"},[this.$startAtCheck=g("input",{type:"checkbox",id:n,$change:this.handleChangeStartAtTimecode.bind(this)}),this.$startAtLabel=g("label",{htmlFor:n})]),this.$qrCanvasContainer=g("div",{className:"url-qrcode"},[g("hr"),this.$qrCanvas=g("canvas")])]))}createShareButton(e){var t;let i;switch(e.type){case"material":i=g("i",{className:"material-icons-round"},[e.icon]);break;case"image":i=g("img",{src:e.src})}return{hrefTemplate:e.hrefTemplate,element:g("a",{title:this.env.t(null!==(t=e.titleTranslationKey)&&void 0!==t?t:"",{},(()=>"")),target:"_blank",rel:"noopener noreferrer",$click:this.handlers.handleClickShareButton},[i])}}handleClickShareButton(e){"dlf:qr_code"===e.currentTarget.href&&(e.preventDefault(),this.setState({showQrCode:!0}))}async handleCopyToClipboard(){const e=this.generateUrl(this.state);this.$urlInput.focus(),navigator.clipboard?navigator.clipboard.writeText(e):document.execCommand("copy")}handleChangeStartAtTimecode(e){e.target instanceof HTMLInputElement&&this.setState({startAtTimecode:e.target.checked})}setTimecode(e){return this.setState({timecode:e}),this}setFps(e){return this.setState({fps:e}),this}generateUrl(e){return q(e.startAtTimecode?e.timecode:null,this.env).toString()}open(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];super.open(e),e||this.setState({showQrCode:!1})}render(e){super.render(e);const{show:t,timecode:i,fps:s,startAtTimecode:n,showQrCode:o}=e,r=this.generateUrl(e),a=r!==this.lastRenderedUrl;if(a){const e=encodeURIComponent(r);for(const t of this.shareButtons)t.element.href=t.hrefTemplate.replace(/{url}/g,e);this.$urlInput.value=r,this.lastRenderedUrl=r}(a||o!==this.state.showQrCode)&&this.renderQrCode(o?r:null),null===i||0===i?this.$startAt.classList.remove("shown"):(this.$startAtCheck.checked=n,this.$startAtLabel.innerText=this.env.t("modal.bookmark.start-at-current-time",{timecode:T(i,!0,s)}),this.$startAt.classList.add("shown")),t&&t!==this.state.show&&this.$urlInput.select()}async renderQrCode(e){if(null!==e)try{await K.toCanvas(this.$qrCanvas,e),this.$qrCanvasContainer.classList.add("dlf-visible")}catch(e){alert(this.env.t("error.qrcode")),console.error(e)}else this.$qrCanvasContainer.classList.remove("dlf-visible")}}function Y(e,t,i){const s=i?".mod":"";return e.t("key.".concat(t).concat(s),{},(()=>e.t("key.".concat(t),{},(()=>e.t("key.generic".concat(s),{key:t.toUpperCase()},(()=>e.t("key.generic",{key:t.toUpperCase()})))))))}function Z(e,t){const i=function(e){const t=[];let i=null;for(const s of e)null===i?i={begin:s,end:s}:s.charCodeAt(0)===i.end.charCodeAt(0)+1?i.end=s:(t.push(i),i={begin:s,end:s});return null!==i&&t.push(i),t}(t.keys),s=[],n=void 0!==t.mod||i.length>1,o=e.t("key.unto".concat(n?".mod":""));for(const t of i){const i=g("kbd",{},[Y(e,t.begin,n)]);if(t.begin===t.end)s.push(i);else{const r=g("kbd",{},[Y(e,t.end,n)]);s.push(g("span",{className:"kb-range"},[i,o,r]))}}let r;return r=t.mod?[g("kbd",{},[e.t("key.mod.".concat(t.mod))])," + ",...f(s,"/")]:f(s," / "),t.repeat&&(r=f(e.t("key.repeat",{key:"###"}).split("###"),r)),g("span",{},r)}class J extends X{constructor(e,t,i){super(e,{}),this.env=t,this.config=i,this.tableSections=[],this.createBodyDom(),this.updateRowVisibility()}open(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e&&this.updateRowVisibility(),super.open(e)}createBodyDom(){const e=this.env;this.$main.classList.add("help-modal"),this.$title.innerText=e.t("modal.help.title");const t=g("table",{className:"keybindings-table"}),i=function(e){const t={navigate:{},player:{},other:{}},i=e.slice();i.sort(((e,t)=>e.order-t.order));for(const e of i){let i=t[e.kind];i||(i=t[e.kind]={});let s=i[e.action];s||(s=i[e.action]=[]),s.push(e)}return t}(this.config.keybindings);for(const[s,n]of Object.entries(i)){const i=[...Object.entries(n)];if(0===i.length)continue;const o={thead:g("thead",{},[g("th",{className:"kb-group",colSpan:2},[e.t("action.kind.".concat(s))])]),tbody:g("tbody",{}),rows:[]};for(const[e,t]of i){const i=g("tr",{},[g("td",{className:"key"},this.listKeybindings(t)),g("td",{className:"action"},[this.describeAction(e)])]);o.rows.push({action:e,tr:i}),o.tbody.append(i)}t.append(o.thead,o.tbody),this.tableSections.push(o)}this.$body.append(t)}listKeybindings(e){return f(e.map((e=>Z(this.env,e))),g("br"))}describeAction(e){return this.env.t("action.".concat(e),this.config.constants)}updateRowVisibility(){for(const e of this.tableSections){let t=!1;for(const i of e.rows){const e=this.config.actionIsAvailable(i.action);i.tr.setAttribute("aria-disabled",e?"false":"true");const s=e?"":this.env.t("action.unavailable");i.tr.setAttribute("title",s),i.tr.setAttribute("aria-label",s),t||(t=e)}y(e.thead,"action-unavailable",!t),y(e.tbody,"action-unavailable",!t)}}}var ee=i(8),te=i.n(ee);class ie{constructor(e){this.jpeg=e,this.exif=te().load(e)}static fromBinaryString(e){return new ie(e)}toBinaryString(){const e=te().dump(this.exif);return te().insert(e,this.jpeg)}addMetadata(e){e.title&&(this.exif["0th"][te().ImageIFD.ImageDescription]=e.title),e.comment&&(this.exif.Exif[te().ExifIFD.UserComment]=e.comment)}getMetadata(){var e,t;return{title:null!==(e=this.exif["0th"][te().ImageIFD.ImageDescription])&&void 0!==e?e:"",comment:null!==(t=this.exif.Exif[te().ExifIFD.UserComment])&&void 0!==t?t:""}}}const se=String.fromCharCode(137,80,78,71,13,10,26,10);class ne{constructor(e,t){this.headerChunk=e,this.chunks=t}static createChunk(e){const t={};switch(e.type){case"raw":t.type=e.rawType,t.data=e.rawData;break;case"iTXt":t.type="iTXt",t.data="".concat(e.keyword.replace(/\0/g,""),"\0\0\0\0\0").concat(e.text);break;case"IEND":t.type="IEND",t.data=""}return t.size=t.data.length,t.crc=function(e){for(var t=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],i=-1,s=0;s<e.length;s++)i=i>>>8^t[255&(i^e.charCodeAt(s))];return(-1^i)>>>0}(t.type+t.data),t}addChunk(e){const t=ne.createChunk(e);if("iTXt"!==t.type)throw new Error("Adding chunk type ".concat(t.type," is not supported."));this.chunks.unshift(t)}static fromBinaryString(e){if(!function(e){return e.substr(0,8)===se}(e.substr(0,8)))return;let t;e=e.substr(8);for(var i=[];""!==e;){var s={},n=re(e.substr(0,4));n<0&&(n=0);var o=e.substr(0,n+12);e=e.substr(n+12),s.size=n,s.type=o.substr(4,4),s.data=o.substr(8,n),s.crc=re(o.substr(8+n,4)),"IHDR"===s.type?t=s:"IEND"!==s.type&&i.push(s)}return void 0===t?void 0:new ne(t,i)}toBinaryString(){var e=se;const t=t=>{var i="";i+=oe(t.size,4),i+=t.type,i+=t.data,i+=oe(t.crc,4),e+=i};t(this.headerChunk);for(const e of this.chunks)t(e);return t(ne.createChunk({type:"IEND"})),e}addMetadata(e){for(const[t,i]of Object.entries(e)){if(!i)continue;const e={title:"Title",comment:"Comment"}[t];e&&this.addChunk({type:"iTXt",keyword:e,text:i})}}}function oe(e,t){for(var i=[],s=t-1;s>=0;){var n=255&e;i[s--]=n,e>>=8}return i=i.map((function(e){return String.fromCharCode(e)})),i.join("")}function re(e){for(var t=0,i=0;i<e.length;i++)t=t<<8|255&e.charCodeAt(i);return t}var ae=[{mimeType:"image/png",extension:"png",label:"PNG",parseBinaryString:e=>ne.fromBinaryString(e)},{mimeType:"image/jpeg",extension:"jpg",label:"JPEG",parseBinaryString:e=>ie.fromBinaryString(e)},{mimeType:"image/tiff",extension:"tiff",label:"TIFF",parseBinaryString:()=>{}}];class le extends X{constructor(e,t,i){var s;const o=ae.filter((e=>t.supportsCanvasExport(e.mimeType)));super(e,{metadata:null,showMetadata:!0,fps:null,timecode:null,supportedImageFormats:o,selectedImageFormat:null!==(s=o[0])&&void 0!==s?s:null}),this.env=t,this.videoDomElement=null,this.config=i,this.constants=n(i.constants,{screenshotFilenameTemplate:"Screenshot",screenshotCommentTemplate:""});const r=this.config.keybindings.find((e=>"modal.screenshot.snap"===e.action));this.$main.classList.add("screenshot-modal"),this.$title.innerText=t.t("modal.screenshot.title");const a=t.mkid(),l=t.mkid();this.$body.append(g("div",{className:"screenshot-config"},[g("h4",{},[t.t("modal.screenshot.configuration")]),g("section",{className:"metadata-config"},[g("h1",{},[t.t("modal.screenshot.metadata")]),g("div",{className:"metadata-overlay"},[g("input",{type:"checkbox",id:a,checked:this.state.showMetadata,$change:this.handleChangeShowMetadata.bind(this)}),g("label",{htmlFor:a},[t.t("modal.screenshot.metadata-overlay")])])]),g("section",{},[g("h1",{},[t.t("modal.screenshot.file-format")]),g("div",{},this.state.supportedImageFormats.map((e=>{var i;const s=t.mkid();return g("span",{className:"file-format-option"},[g("input",{id:s,name:l,type:"radio",checked:e.mimeType===(null===(i=this.state.selectedImageFormat)||void 0===i?void 0:i.mimeType),$change:()=>{this.setState({selectedImageFormat:e})}}),g("label",{htmlFor:s},[" ".concat(e.label)])])})))]),g("a",{href:"#",className:"download-link",$click:this.handleDownloadImage.bind(this)},[g("i",{className:"material-icons-round inline-icon"},["download"]),t.t("modal.screenshot.download-image")]),r&&g("aside",{className:"snap-tip"},[g("i",{className:"material-icons-round inline-icon"},["info_outline"]),g("span",{},f(t.t("modal.screenshot.snap-tip",{keybinding:"{kb}"}).split("{kb}"),Z(t,r)))])]),this.$canvas=g("canvas"))}setVideo(e){return this.videoDomElement=e,this}setMetadata(e){return this.setState({metadata:e}),this}setFps(e){return this.setState({fps:e}),this}setTimecode(e){return this.setState({timecode:e}),this}handleChangeShowMetadata(e){e.target instanceof HTMLInputElement&&this.setState({showMetadata:e.target.checked})}async handleDownloadImage(e){e.preventDefault(),await this.downloadCurrentImage(this.state)}renderCurrentScreenshot(e){let{showMetadata:t,metadata:i}=e;if(null===this.videoDomElement)return!1;const s={captions:t?this.getCaptions(i):[],minWidth:1e3};return function(e,t,i){var s;const[n,o]=e instanceof HTMLCanvasElement?[e,e.getContext("2d")]:[e.canvas,e];if(null===o)return!1;const r=Math.max(1,Math.ceil((null!==(s=i.minWidth)&&void 0!==s?s:0)/t.videoWidth));n.width=t.videoWidth*r,n.height=t.videoHeight*r,o.drawImage(t,0,0,n.width,n.height);const a=n.height/1080,l=10*a;o.font="".concat(Math.floor(25*a),"px Arial"),o.fillStyle="#FFFFFF",o.shadowBlur=5,o.shadowColor="black";for(const e of null!==(h=i.captions)&&void 0!==h?h:[]){var h;const t="left"===e.h?l:n.width-l,i="top"===e.v?l:n.height-l;o.textAlign=e.h,o.fillText(e.text,t,i)}}(this.$canvas,this.videoDomElement,s),!0}async downloadCurrentImage(e){const{metadata:t,timecode:i,selectedImageFormat:s}=e;return null===t||null===i||null===s?(console.error("one of [metadata, timecode, selectedImageFormat] is null"),!1):(p(await this.makeImageBlob(this.$canvas,s,t,i),this.getFilename(t,e.fps,i,s)),!0)}async makeImageBlob(e,t,i,s){const n=await function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return new Promise(((s,n)=>{e.toBlob((e=>{e?s(e):n()}),t,i)}))}(e,t.mimeType),o=await(r=n,new Promise(((e,t)=>{const i=new FileReader;i.onload=()=>{"string"==typeof i.result?e(i.result):t(null)},i.onerror=()=>{t(i.error)},i.readAsBinaryString(r)})));var r;const a=t.parseBinaryString(o);if(a){var l,h;const e=q(s,this.env);a.addMetadata({title:null!==(l=null===(h=i.title)||void 0===h?void 0:h[0])&&void 0!==l?l:"",comment:this.fillExtendedMetadata(this.constants.screenshotCommentTemplate,{...i,url:[e.toString()]})});const t=function(e){const t=new Uint8Array(e.length);for(let i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}(a.toBinaryString());return new Blob([t],{type:n.type})}return n}getFilename(e,t,i,s){const n=this.fillExtendedMetadata(C(this.constants.screenshotFilenameTemplate,i,t),e),o=s.extension;return"".concat(function(e){const t=e.replace(/[^a-zA-Z0-9()]+/g,"_");return t.length>0?t:"_"}(n),".").concat(o)}getCaptions(e){return this.config.screnshotCaptions.map((t=>({...t,text:this.fillExtendedMetadata(t.text,null!=e?e:{})})))}fillExtendedMetadata(e,t){return function(e,t){return d(e,Object.fromEntries(Object.entries(t).map((e=>{var t;let[i,s]=e;return[i,null!==(t=s[0])&&void 0!==t?t:""]}))))}(e,{...t,host:["".concat(location.protocol,"//").concat(location.host)]})}async snap(){await this.update();const e=this.state;this.renderCurrentScreenshot(e)&&await this.downloadCurrentImage(e)||alert(this.env.t("modal.screenshot.error"))}render(e){super.render(e),e.show&&(!this.state.show||e.showMetadata!==this.state.showMetadata)&&this.renderCurrentScreenshot(e)}}var he=JSON.parse('[{"keys":["Escape"],"action":"cancel","kind":"other","order":100},{"keys":["F1"],"repeat":false,"action":"modal.help.toggle","kind":"other","order":99},{"keys":["b"],"scope":"player","action":"modal.bookmark.open","kind":"other","order":30},{"keys":["s"],"scope":"player","action":"modal.screenshot.open","kind":"other","order":31},{"keys":["s"],"mod":"Shift","scope":"player","action":"modal.screenshot.snap","kind":"other","order":32},{"keys":["f"],"repeat":false,"scope":"player","action":"fullscreen.toggle","kind":"player","order":20},{"keys":["t"],"repeat":false,"scope":"player","action":"theater.toggle","kind":"player","order":21},{"keys":[" "],"repeat":false,"scope":"player","action":"playback.toggle","kind":"player","order":0},{"keys":["m"],"repeat":false,"scope":"player","action":"playback.volume.mute.toggle","kind":"player","order":12},{"keys":["ArrowUp"],"scope":"player","action":"playback.volume.inc","kind":"player","order":10},{"keys":["ArrowDown"],"scope":"player","action":"playback.volume.dec","kind":"player","order":11},{"keys":["c"],"repeat":false,"scope":"player","action":"playback.captions.toggle","kind":"player","order":13},{"keys":["ArrowLeft"],"repeat":false,"scope":"player","action":"navigate.rewind","kind":"navigate","order":0},{"keys":["ArrowRight"],"repeat":false,"scope":"player","action":"navigate.seek","kind":"navigate","order":1},{"keys":["ArrowLeft"],"repeat":true,"scope":"player","action":"navigate.continuous-rewind","kind":"navigate","order":2},{"keys":["ArrowRight"],"repeat":true,"scope":"player","action":"navigate.continuous-seek","kind":"navigate","order":3},{"mod":"CtrlMeta","keys":["ArrowLeft"],"scope":"player","action":"navigate.chapter.prev","kind":"navigate","order":10},{"mod":"CtrlMeta","keys":["ArrowRight"],"scope":"player","action":"navigate.chapter.next","kind":"navigate","order":11},{"keys":["0","1","2","3","4","5","6","7","8","9"],"scope":"player","action":"navigate.position.percental","kind":"navigate","order":25},{"mod":"Shift","keys":["ArrowLeft"],"scope":"player","action":"navigate.frame.prev","kind":"navigate","order":20},{"mod":"Shift","keys":["ArrowRight"],"scope":"player","action":"navigate.frame.next","kind":"navigate","order":21},{"keys":[","],"scope":"player","action":"navigate.frame.prev","kind":"navigate","order":20},{"keys":["."],"scope":"player","action":"navigate.frame.next","kind":"navigate","order":21},{"keys":["Shift"],"scope":"player","action":"navigate.thumbnails.snap","kind":"navigate","order":30,"keydown":true,"keyup":true}]');class de extends j{constructor(){super(),this.metadata={},this.keybindings=he,this.handlers={onKeyDown:this.onKeyDown.bind(this),onKeyUp:this.onKeyUp.bind(this),onClickChapterLink:this.onClickChapterLink.bind(this),onCloseModal:this.onCloseModal.bind(this)},this.chapterLinks=[],this.fullscreenElement=null,this.modals=null}connectedCallback(){var e,t,i;super.connectedCallback(),null===this.startTime&&(this.startTime=null!==(i=this.getStartTime())&&void 0!==i?i:null),this.fullscreenElement=document.getElementById(null!==(e=this.getAttribute("fullscreen-element"))&&void 0!==e?e:"");const s=this.getConfig(),o=n(null!==(t=s.constants)&&void 0!==t?t:{},this.constants);var r,a,l;null!==this.fullscreenElement&&(this.modals=function(e){const t=Object.values(e),i=document.createElement("div");i.className="sxnd-modal-cover",i.addEventListener("click",(()=>{n.closeAll()})),document.body.append(i);const s={toggleExclusive:e=>{e.isOpen?e.close():n.hasOpen()||e.open()},setFullscreen:e=>{(null!=e?e:document.body).append(i)},hasOpen:()=>t.some((e=>e.isOpen)),closeNext:()=>{for(const e of t)if(e.isOpen){e.close();break}},closeAll:()=>{for(const e of t)e.close()},update:async()=>{await Promise.all(t.map((e=>e.update())))},resize:()=>{for(const e of t)e.resize()}},n=Object.assign(new(G()),e,s);window.addEventListener("resize",(()=>{n.resize()})),document.addEventListener("fullscreenchange",(()=>{n.setFullscreen(document.fullscreenElement)}));for(const e of t)e.on("updated",(()=>{e.isOpen||n.emit("closed",e),n.hasOpen()?i.classList.add("shown"):i.classList.remove("shown")}));return n}({help:new J(this.fullscreenElement,this.env,{constants:{...o,forceLandscapeOnFullscreen:Number(this.constants.forceLandscapeOnFullscreen)},keybindings:this.keybindings,actionIsAvailable:e=>{const t=this.actions[e];return void 0!==t&&t.isAvailable()}}),bookmark:new Q(this.fullscreenElement,this.env,{shareButtons:null!==(r=s.shareButtons)&&void 0!==r?r:[]}),screenshot:new le(this.fullscreenElement,this.env,{keybindings:this.keybindings,screnshotCaptions:null!==(a=s.screenshotCaptions)&&void 0!==a?a:[],constants:null!==(l=s.constants)&&void 0!==l?l:{}})}),this.modals.on("closed",this.handlers.onCloseModal)),setTimeout((()=>{this.loadMetadata()}))}loadMetadata(){this.querySelectorAll("dlf-meta").forEach((e=>{const t=e.getAttribute("key"),i=e.getAttribute("value");if(!t||!i)return void console.warn("Ignoring invalid <dlf-meta>");let s=this.metadata[t];void 0===s&&(s=this.metadata[t]=[]),s.push(i)}))}constantDefaults(){return{...super.constantDefaults(),forceLandscapeOnFullscreen:!0}}getActions(){return{...super.getActions(),cancel:$((()=>{var e;null!==(e=this.modals)&&void 0!==e&&e.hasOpen()?this.modals.closeNext():this.ui.handleEscape()})),"modal.help.open":$((()=>{var e;this.openModal(null===(e=this.modals)||void 0===e?void 0:e.help)})),"modal.help.toggle":$((()=>{var e;null!==this.modals&&(null===(e=this.ui.seekBar)||void 0===e||e.endSeek(),this.modals.toggleExclusive(this.modals.help))})),"modal.bookmark.open":$((()=>{this.showBookmarkUrl()})),"modal.screenshot.open":$({isAvailable:()=>!this.isAudioOnly(),execute:()=>{this.showScreenshot()}}),"modal.screenshot.snap":$({isAvailable:()=>!this.isAudioOnly(),execute:()=>{this.snapScreenshot()}}),"theater.toggle":$((()=>{var e;null===(e=this.ui.seekBar)||void 0===e||e.endSeek();const t=new CustomEvent("dlf-theater-mode",{detail:{action:"toggle",persist:!0}});window.dispatchEvent(t)}))}}getStartTime(){const e=super.getStartTime();if(null!==e)return e;const t=this.env.getLocation().searchParams.get("timecode");return null!==t&&t?parseFloat(t):null}getLinkTimecode(e){const t=e.getAttribute("data-timecode");if(null!==t){const e=Number(t);if(Number.isFinite(e))return e}const i=e.hash.match(/timecode=(\d+(\.\d?)?)/);if(null!==i){const e=Number(i[1]);if(Number.isFinite(e))return e}return null}onDomContentLoaded(){super.onDomContentLoaded(),document.querySelectorAll("a[data-timecode], .tx-dlf-tableofcontents a").forEach((e=>{const t=e,i=this.getLinkTimecode(t);if(null!==i){const t=e;t.dlfTimecode=i,t.addEventListener("click",this.handlers.onClickChapterLink),this.chapterLinks.push(t)}}))}loaded(){var e;null===(e=this.modals)||void 0===e||e.resize()}configureFrontend(e){super.configureFrontend(e),this.ui instanceof _&&this.ui.addControlElement(b.register(this.env,{className:"sxnd-screenshot-button",material_icon:"photo_camera",title:this.env.t("control.screenshot.tooltip"),onClickAction:this.actions["modal.screenshot.open"]}),b.register(this.env,{className:"sxnd-bookmark-button",material_icon:"bookmark_border",title:this.env.t("control.bookmark.tooltip"),onClickAction:this.actions["modal.bookmark.open"]}),M.register(this.env,{onClickAction:this.actions["fullscreen.toggle"]}),b.register(this.env,{className:"sxnd-help-button",material_icon:"info_outline",title:this.env.t("control.help.tooltip"),onClickAction:this.actions["modal.help.open"]})),document.addEventListener("keydown",this.handlers.onKeyDown,{capture:!0}),document.addEventListener("keyup",this.handlers.onKeyUp,{capture:!0})}getKeyboardScope(){var e;if(null!==(e=this.modals)&&void 0!==e&&e.hasOpen())return"modal";for(const e of Array.from(document.querySelectorAll("input:focus")))if(e instanceof HTMLElement&&null!==e.offsetParent)return"input";return"player"}onKeyDown(e){if(this.hasVideo){var t;if("Escape"===e.key&&e.stopImmediatePropagation(),this.ui instanceof _)if("F2"===e.key)this.ui.updatePlayerProperties({mode:"audio"}),null===(t=this.modals)||void 0===t||t.resize();else if("F4"===e.key){var i;this.ui.updatePlayerProperties({mode:"video"}),null===(i=this.modals)||void 0===i||i.resize()}this.handleKey(e,"down")}}onKeyUp(e){this.hasVideo&&(e.stopImmediatePropagation(),this.handleKey(e,"up"),this.cancelTrickPlay())}handleKey(e,t){const i=this.getKeyboardScope(),n=function(e,t,i){const n=function(e){let t=s.None;return(e.ctrlKey&&"Control"!==e.key||e.metaKey&&"Meta"!==e.key)&&(t|=s.CtrlMeta),e.shiftKey&&"Shift"!==e.key&&(t|=s.Shift),e.altKey&&"Alt"!==e.key&&(t|=s.Alt),t}(t),o=t.key.toLowerCase();for(const a of e){var r;const e=a.keys.findIndex((e=>e.toLowerCase()===o));if(-1!==e&&!(null!=a.repeat&&a.repeat!==t.repeat||null!=a.scope&&a.scope!==i||s[null!==(r=a.mod)&&void 0!==r?r:"None"]!==n))return{keybinding:a,keyIndex:e}}}(this.keybindings,e,i);if(n){var o,r;const{keybinding:i,keyIndex:s}=n;e.preventDefault();const a="down"===t&&(null===(o=i.keydown)||void 0===o||o)||"up"===t&&null!==(r=i.keyup)&&void 0!==r&&r,l=this.actions[i.action];a&&void 0!==l&&l.isAvailable()&&l.execute(i,s,t)}}onClickChapterLink(e){e.preventDefault();const t=e.currentTarget;this.media.play(),this.seekTo(t.dlfTimecode)}onCloseModal(e){this.resumeOn(e)}async toggleFullScreen(){var e;this.env.toggleFullScreen(null!==(e=this.fullscreenElement)&&void 0!==e?e:this.ui.domElement,this.constants.forceLandscapeOnFullscreen)}showBookmarkUrl(){var e,t;if(!this.hasCurrentData)return;const i=null===(e=this.modals)||void 0===e?void 0:e.bookmark.setTimecode(this.displayTime).setFps(null!==(t=this.getFps())&&void 0!==t?t:0);this.openModal(i,!0)}prepareScreenshot(){var e;if(this.hasCurrentData)return null===(e=this.modals)||void 0===e?void 0:e.screenshot.setVideo(this.video).setMetadata(this.metadata).setFps(this.getFps()).setTimecode(this.displayTime)}showScreenshot(){const e=this.prepareScreenshot();this.openModal(e,!0)}snapScreenshot(){const e=this.prepareScreenshot();null==e||e.snap()}openModal(e){var t;null!=e&&(arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this.pauseOn(e),null===(t=this.ui.seekBar)||void 0===t||t.endSeek(),e.open())}}customElements.define("slub-media",de),window.SlubMediaPlayer=de}},i={};function s(e){var n=i[e];if(void 0!==n)return n.exports;var o=i[e]={exports:{}};return t[e](o,o.exports,s),o.exports}s.m=t,e=[],s.O=(t,i,n,o)=>{if(!i){var r=1/0;for(d=0;d<e.length;d++){i=e[d][0],n=e[d][1],o=e[d][2];for(var a=!0,l=0;l<i.length;l++)(!1&o||r>=o)&&Object.keys(s.O).every((e=>s.O[e](i[l])))?i.splice(l--,1):(a=!1,o<r&&(r=o));if(a){e.splice(d--,1);var h=n();void 0!==h&&(t=h)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[i,n,o]},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={825:0};s.O.j=t=>0===e[t];var t=(t,i)=>{var n,o,r=i[0],a=i[1],l=i[2],h=0;if(r.some((t=>0!==e[t]))){for(n in a)s.o(a,n)&&(s.m[n]=a[n]);if(l)var d=l(s)}for(t&&t(i);h<r.length;h++)o=r[h],s.o(e,o)&&e[o]&&e[o][0](),e[r[h]]=0;return s.O(d)},i=self.webpackChunkslub_web_sachsendigital=self.webpackChunkslub_web_sachsendigital||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var n=s.O(void 0,[276],(()=>s(975)));n=s.O(n)})();
//# sourceMappingURL=SxndPlayerApp.js.map