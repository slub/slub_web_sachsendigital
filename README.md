# SACHSEN.digital (LDP & SAVE)

## Remark

The following lines are only temporary and have to be changed...
    
    "kitodo/presentation": "^4.0|dev-master|dev-dev-sxnd-fixes",
    "slub/slub-digitalcollections": "^3.0|dev-master|dev-dev-sxnd-fixes"
    
    to...
    
    "kitodo/presentation": "^4.0|dev-master",
    "slub/slub-digitalcollections": "^3.0|dev-master"
    
    ...as soon as both bracehs in kitodo.preseentation and digitalcollections are merged.

This TYPO3 extension provides the configuration and setup for the new implementation of SACHSEN.digital by the [SLUB Dresden](https://www.slub-dresden.de).

##  Installation
This extension needs to reside in a folder called `slub_web_sachsendigital` in TYPO3 extension folder ('typoconf/ext').

After activate the extension in the TYPO3 extension manager you need to include a static template called `SLUB: Portal Sachsen.Digital` in the template settings of the source page of the SACHSEN.digtal branch.

## Upgrade to Kitodo.Presentation 4

To upgrade an existing installation:

- Follow the steps described in the upgrade guide of Kitodo.Presentation, in particular:
  - Set storage PID in template
  - Run the upgrade wizards and database update
  - Update CSP
  - In the List View plugin of the search page, set the target PID

## Configuration

The player is configured in [media.typoscript](Configuration/TypoScript/Plugins/media.typoscript).

`settings.shareButtons` may be used to configure which sharing buttons are
available in the bookmarks modal:

- *Button icon*: Use
  - either `type = material` and `icon = ...` to use the specified Material Icon,
  - or `type = image` and `src = ` to use an image at the specified URL.
- *Tooltips*: Set `titleTranslationKey` to a translation key that is defined in
  the `playerTranslations` file.
- *Share target*: Enter a link URL in `hrefTemplate`
  - The placeholder `{url}` will be replaced by the URL to be shared.
  - The special value `dlf:qr_code` may be used to generate a QR code.

`constants` may be used to configure the video player:

- `prevChapterTolerance`: Number of seconds in which to still rewind to previous chapter
- `volumeStep`: Fractional value of volume increase/decrease when pressing up/down arrow keys
- `seekStep`: Number of seconds for seek/rewind
- `trickPlayFactor`: Trick play factor for continuous rewind/seek
- `forceLandscapeOnFullscreen`: Whether or not to switch to landscape in fullscreen mode

## Frontend Development

Anything related to building the JavaScript and Less code is located in `Build/`, which is the working directory for all commands listed in this section.

In general, `Resources/Private/{JavaScript,Less}` contain the written code, while `Resources/Public/{JavaScript,Css}` contain the compiled code as generated by the build process.

### Getting Started

For selecting the proper Node version, you may either use [NVM](https://github.com/nvm-sh/nvm) or check [`Build/.nvmrc`](./Build/.nvmrc).

```bash
nvm install  # If you use NVM
npm install
```

### Development

You may use the following command to build the code in development mode and watch for file changes:

```bash
nvm use  # If you use NVM
npm run watch
```

### Production

Before committing, please run the following command to build the code in production mode:

```bash
nvm use  # If you use NVM
npm run build
```

### Running Tests

```bash
npm test

# (Alternative) Watch mode
npm test -- --watch

# With coverage report
npm test -- --coverage
xdg-open coverage/lcov-report/index.html
```

### Typings

```bash
npm run typecheck

# (Alternative) Watch mode
npm run tsc-watch
```

### Browser Compatibility

```bash
npm run compat
npm run compat-build
```

### Remarks

- jQuery is marked as external in Webpack config

## Dependencies

- TYPO3 CMS Frontend (cms)
- Extbase Framework (Extbase)
- Fluid Templating Engine (fluid)
- Kitodo.Presentatioin (dlf)
- News system (news)
